<ActorFrame> <children>
<Layer Type="ActorFrame" Var="y_bg" OnCommand="fov,60;hidden,1;diffusealpha,0" FarDist="1000000"><children>
			
			<Layer File="y_sky" Var="y_sky" OnCommand="hidden,0" />
			<Layer File="y_moonglow" Var="y_moonglow" OnCommand="hidden,0" />
			<Layer File="y_moon.png" Var="y_moon" OnCommand="hidden,0" />
			<Layer File="y_clouds.png" Var="y_clouds" OnCommand="hidden,0" />
			<Layer File="y_mountain" Var="y_mountain" OnCommand="hidden,0" />
			<Layer File="y_watbg" Var="y_waterbg" OnCommand="hidden,0" />

			<Layer File="y_faith" Var="y_faithl1" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="y_faithl2" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="y_faithl3" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="ym_faithl1" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="ym_faithl2" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="ym_faithl3" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="y_faithr1" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="y_faithr2" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="y_faithr3" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="ym_faithr1" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="ym_faithr2" OnCommand="hidden,0" />
			<Layer File="y_faith" Var="ym_faithr3" OnCommand="hidden,0" />
			<Layer File="y_water" Var="y_water" OnCommand="hidden,0" />
			<Layer OnCommand="hidden,1;stretchto,0,0,SCREEN_WIDTH,SCREEN_HEIGHT;diffusealpha,0;"
			CurrentSongChangedMessageCommand="%function(self) self:queuecommand('epic') end"
	epicCommand="%function(self)
		local y_faithl = {}
local ym_faithl = {}
local y_faithr = {}
local ym_faithr = {}
local scx = SCREEN_CENTER_X
local scy = SCREEN_CENTER_Y
local sw = SCREEN_WIDTH
local sh = SCREEN_HEIGHT
local sqrt = math.sqrt

local sin = math.sin
local asin = math.asin
local cos = math.cos
local pow = math.pow
local exp = math.exp
local pi = math.pi
local abs = math.abs

flip = setmetatable({}, {
    __call = function(self, fn)
        self[fn] = self[fn] or function(x) return 1 - fn(x) end
        return self[fn]
    end
})

function with1param(fn, defaultparam1)
    local function params(param1) return function(x) return fn(x, param1) end end
    return setmetatable({params = params, param = params}, {
        __call = function(self, x, param1)
            return fn(x, param1 or defaultparam1)
        end
    })
end

function with2params(fn, defaultparam1, defaultparam2)
    local function params(param1, param2)
        return function(x) return fn(x, param1, param2) end
    end
    return setmetatable({params = params, param = params}, {
        __call = function(self, x, param1, param2)
            return fn(x, param1 or defaultparam1, param2 or defaultparam2)
        end
    })
end
function bounce(t) return 4 * t * (1 - t) end
function tri(t) return 1 - abs(2 * t - 1) end
function bell(t) return inOutQuint(tri(t)) end
function pop(t) return 3.5 * (1 - t) * (1 - t) * sqrt(t) end
function tap(t) return 3.5 * t * t * sqrt(1 - t) end
function pulse(t) return t < .5 and tap(t * 2) or -pop(t * 2 - 1) end

function spike(t) return exp(-10 * abs(2 * t - 1)) end
function inverse(t) return t * t * (1 - t) * (1 - t) / (0.5 - t) end

local function popElasticInternal(t, damp, count)
    return (1000 ^ -(t ^ damp) - 0.001) * sin(count * pi * t)
end

local function tapElasticInternal(t, damp, count)
    return (1000 ^ -((1 - t) ^ damp) - 0.001) * sin(count * pi * (1 - t))
end

local function pulseElasticInternal(t, damp, count)
    if t < .5 then
        return tapElasticInternal(t * 2, damp, count)
    else
        return -popElasticInternal(t * 2 - 1, damp, count)
    end
end

popElastic = with2params(popElasticInternal, 1.4, 6)
tapElastic = with2params(tapElasticInternal, 1.4, 6)
pulseElastic = with2params(pulseElasticInternal, 1.4, 6)

impulse = with1param(function(t, damp)
    t = t ^ damp
    return t * (1000 ^ -t - 0.001) * 18.6
end, 0.9)

function instant() return 1 end
function linear(t) return t end
function inQuad(t) return t * t end
function outQuad(t) return -t * (t - 2) end
function inOutQuad(t)
    t = t * 2
    if t < 1 then
        return 0.5 * t ^ 2
    else
        return 1 - 0.5 * (2 - t) ^ 2
    end
end
function inCubic(t) return t * t * t end
function outCubic(t) return 1 - (1 - t) ^ 3 end
function inOutCubic(t)
    t = t * 2
    if t < 1 then
        return 0.5 * t ^ 3
    else
        return 1 - 0.5 * (2 - t) ^ 3
    end
end
function inQuart(t) return t * t * t * t end
function outQuart(t) return 1 - (1 - t) ^ 4 end
function inOutQuart(t)
    t = t * 2
    if t < 1 then
        return 0.5 * t ^ 4
    else
        return 1 - 0.5 * (2 - t) ^ 4
    end
end
function inQuint(t) return t ^ 5 end
function outQuint(t) return 1 - (1 - t) ^ 5 end
function inOutQuint(t)
    t = t * 2
    if t < 1 then
        return 0.5 * t ^ 5
    else
        return 1 - 0.5 * (2 - t) ^ 5
    end
end
function inExpo(t) return 1000 ^ (t - 1) - 0.001 end
function outExpo(t) return 1.001 - 1000 ^ -t end
function inOutExpo(t)
    t = t * 2
    if t < 1 then
        return 0.5 * 1000 ^ (t - 1) - 0.0005
    else
        return 1.0005 - 0.5 * 1000 ^ (1 - t)
    end
end
function inCirc(t) return 1 - sqrt(1 - t * t) end
function outCirc(t) return sqrt(-t * t + 2 * t) end
function inOutCirc(t)
    t = t * 2
    if t < 1 then
        return 0.5 - 0.5 * sqrt(1 - t * t)
    else
        t = t - 2
        return 0.5 + 0.5 * sqrt(1 - t * t)
    end
end

function outBounce(t)
    if t < 1 / 2.75 then
        return 7.5625 * t * t
    elseif t < 2 / 2.75 then
        t = t - 1.5 / 2.75
        return 7.5625 * t * t + 0.75
    elseif t < 2.5 / 2.75 then
        t = t - 2.25 / 2.75
        return 7.5625 * t * t + 0.9375
    else
        t = t - 2.625 / 2.75
        return 7.5625 * t * t + 0.984375
    end
end
function inBounce(t) return 1 - outBounce(1 - t) end
function inOutBounce(t)
    if t < 0.5 then
        return inBounce(t * 2) * 0.5
    else
        return outBounce(t * 2 - 1) * 0.5 + 0.5
    end
end

function inSine(x) return 1 - cos(x * (pi * 0.5)) end

function outSine(x) return sin(x * (pi * 0.5)) end

function inOutSine(x) return 0.5 - 0.5 * cos(x * pi) end

function outElasticInternal(t, a, p)
    return a * pow(2, -10 * t) *
               sin((t - p / (2 * pi) * asin(1 / a)) * 2 * pi / p) + 1
end
local function inElasticInternal(t, a, p)
    return 1 - outElasticInternal(1 - t, a, p)
end
function inOutElasticInternal(t, a, p)
    return t < 0.5 and 0.5 * inElasticInternal(t * 2, a, p) or 0.5 + 0.5 *
               outElasticInternal(t * 2 - 1, a, p)
end

inElastic = with2params(inElasticInternal, 1, 0.3)
outElastic = with2params(outElasticInternal, 1, 0.3)
inOutElastic = with2params(inOutElasticInternal, 1, 0.3)

function inBackInternal(t, a) return t * t * (a * t + t - a) end
function outBackInternal(t, a)
    t = t - 1
    return t * t * ((a + 1) * t + a) + 1
end
function inOutBackInternal(t, a)
    return t < 0.5 and 0.5 * inBackInternal(t * 2, a) or 0.5 + 0.5 *
               outBackInternal(t * 2 - 1, a)
end

inBack = with1param(inBackInternal, 1.70158)
outBack = with1param(outBackInternal, 1.70158)
inOutBack = with1param(inOutBackInternal, 1.70158)

local y_sky = self:GetParent():GetChildAt(0)
local y_moonglow = self:GetParent():GetChildAt(1)
local y_moon = self:GetParent():GetChildAt(2)
local y_clouds = self:GetParent():GetChildAt(3)
local y_mountain = self:GetParent():GetChildAt(4)
local y_watbg = self:GetParent():GetChildAt(5)
y_faithl[1] = self:GetParent():GetChildAt(6)
y_faithl[2] = self:GetParent():GetChildAt(7)
y_faithl[3] = self:GetParent():GetChildAt(8)
ym_faithl[1] = self:GetParent():GetChildAt(9)
ym_faithl[2] = self:GetParent():GetChildAt(10)
ym_faithl[3] = self:GetParent():GetChildAt(11)
y_faithr[1] = self:GetParent():GetChildAt(12)
y_faithr[2] = self:GetParent():GetChildAt(13)
y_faithr[3] = self:GetParent():GetChildAt(14)
ym_faithr[1] = self:GetParent():GetChildAt(15)
ym_faithr[2] = self:GetParent():GetChildAt(16)
ym_faithr[3] = self:GetParent():GetChildAt(17)
self:finishtweening()
if GAMESTATE:GetCurrentSong() and GAMESTATE:GetCurrentSong():GetDisplayMainTitle() == 'GHOUL' then

    y_bg:diffusealpha(0)
    y_bg:hidden(0)
    y_bg:decelerate(1)
    y_bg:diffusealpha(1)
    y_bg:sleep(0)
    local faithx = {140, 190, 260}
    local faithzoom = {.4, .55, .8}
    local faithzoom2 = {.2, .5, 1}
    local faithy = {.4, .55, .8}

    for i = 1, 3 do
        y_faithl[i]:hidden(0)
        y_faithr[i]:hidden(0)

        ym_faithl[i]:hidden(0)
        ym_faithr[i]:hidden(0)
        ym_faithl[i]:basezoomy(-1)
        ym_faithr[i]:basezoomy(-1)

        y_faithl[i]:zoom(faithzoom[i])
        y_faithl[i]:xy(scx - (faithx[i]), scy)
        y_faithr[i]:zoom(faithzoom[i])
        y_faithr[i]:xy(scx + (faithx[i]), scy)

        ym_faithl[i]:diffusealpha(.4)
        ym_faithl[i]:zoom(faithzoom[i])
        ym_faithl[i]:xy(scx - (faithx[i]), scy + 400 * faithzoom[i])
        ym_faithr[i]:diffusealpha(.4)
        ym_faithr[i]:zoom(faithzoom[i])
        ym_faithr[i]:xy(scx + (faithx[i]), scy + 400 * faithzoom[i])

        y_faithl[i]:addy(120 + 200 * faithzoom2[i])
        y_faithl[i]:tween(8 * 60 / 230, outCubic)
        y_faithl[i]:addy(-120 - 200 * faithzoom2[i])
        y_faithr[i]:addy(120 + 200 * faithzoom2[i])
        y_faithr[i]:tween(8 * 60 / 230, outCubic)
        y_faithr[i]:addy(-120 - 200 * faithzoom2[i])

        ym_faithl[i]:addy(120 + 200 * faithzoom2[i])
        ym_faithl[i]:tween(8 * 60 / 230, outCubic)
        ym_faithl[i]:addy(-120 - 200 * faithzoom2[i])
        ym_faithr[i]:addy(120 + 200 * faithzoom2[i])
        ym_faithr[i]:tween(8 * 60 / 230, outCubic)
        ym_faithr[i]:addy(-120 - 200 * faithzoom2[i])

    end
    y_sky:hidden(0)
    y_sky:stretchto(0, 0, sw, sh)

    y_moonglow:hidden(0)
    y_moonglow:xy(scx, scy - 160)
    y_moonglow:blend('add')
    y_moonglow:diffusealpha(.8)
    y_moonglow:zoom(.5)

    y_moon:hidden(0)
    y_moon:xy(scx, scy - 160)
    y_moon:zoom(.5)

    y_clouds:hidden(0)
    y_clouds:xy(scx, scy * .5)
    y_clouds:customtexturerect(0, 0, 5, 10)
    y_clouds:zoom(5)
    y_clouds:texcoordvelocity(.02, 0)
    y_clouds:blend('add')
    y_clouds:diffusealpha(.3)

    y_mountain:hidden(0)
    y_mountain:valign(1)
    y_mountain:croptop(.03)
    y_mountain:xy(scx, sh - 120)
    y_mountain:zoomx(3)
    y_mountain:zoomy(.5)
    y_mountain:customtexturerect(0, 0, 5, 1)

    y_mountain:addy(120)
    y_mountain:tween(8 * 60 / 230, outCubic)
    y_mountain:addy(-120)

    y_waterbg:hidden(0)
    y_waterbg:stretchto(0, sh / 2, sw, sh)
    y_waterbg:addy(60)
    y_waterbg:fadetop(.03)
    y_waterbg:diffuse(.6, .6, .6, 1)

    y_waterbg:addy(120)
    y_waterbg:tween(8 * 60 / 230, outCubic)
    y_waterbg:addy(-120)

    y_water:hidden(0)
    y_water:xy(scx, sh + 50, z, -1200)
    y_water:customtexturerect(0, 0, 1, 2)
    y_water:rotationx(-75)
    y_water:zoom(1.8)
    y_water:zoomz(9)
    y_water:fadetop(.2)
    y_water:fadebottom(1)
    y_water:texcoordvelocity(0, -.02)
    y_water:blend('add')

    y_water:addy(600)
    y_water:rotationx(-20)
    y_water:tween(8 * 60 / 230, outCubic)
    y_water:addy(-600)
    y_water:rotationx(-75)

else

    y_bg:hidden(1)

end

		
	end" />

</children></Layer>
	
	<ActorFrame Command="queuecommand,Icon" IconCommand="%function(self) StyleIcon(); if not OatProfile().OATShowHeaders then SCREENMAN:GetTopScreen():GetChild('StyleIcon'):hidden(1) end end" />
	<ActorFrame Command="%function() if GAMESTATE:GetCoinMode() == 1 and not GetPref('EventMode') then rateMods=rateModsPay else rateMods=rateModsFree end end" />
	<Layer 
		File="@'Banner'..Color()..'.png'"
		OnCommand="x,SCREEN_CENTER_X-(SCREEN_WIDTH*160/640-3);y,SCREEN_CENTER_Y-138;ZoomToWidth,306;ZoomToHeight,119"
		OffCommand=""
	/>
	<Layer 
		Type="BitmapText"
		Font="_sanseriffic small"
		Text="ARTIST"
		OnCommand="horizalign,right;ShadowLength,0;diffuse,#FFFFFF66;zoom,0.5;x,SCREEN_CENTER_X-(SCREEN_WIDTH*160/640+105);y,180"
	/>
	<Layer 
		Type="BitmapText"
		Font="_sanseriffic small"
		Text="BPM"
		OnCommand="horizalign,right;ShadowLength,0;diffuse,#FFFFFF66;zoom,0.5;x,SCREEN_CENTER_X-(SCREEN_WIDTH*160/640+105);y,200"
	/>
	<Layer 
		Type="BitmapText"
		Font="_sanseriffic small"
		Text="LENGTH"
		OnCommand="ShadowLength,0;diffuse,#FFFFFF66;zoom,0.5;x,SCREEN_CENTER_X-(SCREEN_WIDTH*160/640);y,200"
	/>
	<ActorFrame InitCommand="%SelectMusicInit" FirstUpdateCommand="%SelectMusic" CaptureCommand="%SongInfo" CurrentSongChangedMessageCommand="queuecommand,Capture" CurrentStepsP1ChangedMessageCommand="queuecommand,Capture" CurrentStepsP2ChangedMessageCommand="queuecommand,Capture" />
	<!-- rpc shenanigans -->
	<Layer
		Type="Quad"
		InitCommand="%function(self)
			self:hidden(1)
			oat_RPC:set('state', 'Menu')
			oat_RPC:set('browsingsince', os.time())

			self:queuecommand('Update')
		end"
		UpdateCommand="%function(self)
			local song=GAMESTATE:GetCurrentSong()
			if song then
				oat_RPC:set('pack', song:GetGroupName())
			else
				oat_RPC:set('pack', '')
			end
			oat_RPC:update()

			self:sleep(3)
			self:queuecommand('Update')
		end"
	/>
</children> </ActorFrame>
